<?php

include("includes/head.php");
include("includes/sidebar.php");
include("includes/nav.php");
include("includes/portfolio-grid.php");
include("includes/footer.php");

$portfolioPieces = parse_ini_file("pieces.ini", true);
$currentPage = basename($_SERVER['REQUEST_URI'], ".html");

$title = "Contact | Ethan Muller's Portfolio";
$header = "";
$description = "I'm Ethan Muller. I do web design and print design. Contact me here.";
$tags = Array('ethan muller', 'ethan muller email');
$form = <<<EOT
			<form action="contact.html" method="post"><!-- start form -->
				<label for="email">email <span>*</span></label><input required type="email" id="email" name="email" value="{$_POST['email']}" /><br />
				<label for="name">name</label><input type="name" id="name" name ="name" value="{$_POST['name']}" /><br />
				<label for="subject">subject</label><input type="text" id="subject" name="subject" value="{$_POST['subject']}" /><br />
				<label for="message">message <span>*</span></label><textarea required rows="6" id="message" name="message">{$_POST['message']}</textarea><br />
					<button type="submit" name="submit" class="send-mail" value="submit">Send</button>
				</form><!-- end form -->
EOT;

?>
<?php printHead($title, $description, $tags); ?>
<?php printSidebar($portfolioPieces, $currentPage); ?>

			<div class="content"><!-- start .content -->

<?php
if (isset($_POST['submit']))
// if form was submitted, check for errors then send
  {
		if ($_POST['email']==""){
		// if email was left out
			$error = "You must enter your email address.<br />";
		}

		if ($_POST['message']==""){
		// if message was left out
			$error = $error . "You must enter a message.<br />";
		}

		if (isset($error))
		// if there were errors, display them and print form
		{
			echo <<<EOT
				<header>
					<div class="error">
						$error
					</div>
				</header>
			$form
EOT;
		} else
		// if there were no errors, send email and thank user
		{
			$to = "ethanbmuller+webform@gmail.com";
			$email = $_POST['email'];
			$name = ( $_POST['name'] ) ? $_POST['name'] : "[no name]";
			$message = "$name\n\n" . $_POST['message'];
			$subject = ($_POST['subject']) ? $_POST['subject'] : "[no subject]";
			$headers = "From:" . $email;

			mail($to,$subject,$message,$headers);

			echo <<<EOT
				<header>
					<div class="thanks">
						<strong>Thank you!</strong> I'll get back to you ASAP.
					</div>
				</header>
EOT;
		}

	} else
//if form wasn't submitted, display header and the form
	{ ?>
				<header><!-- start header -->

					<h1>
						<strong>To send me an email, please fill out the form below.</strong><br/>
						I'm also on
						<a href="http://www.twitter.com/ethanmuller" target="_blank">the Twitter</a> and
						<a href="http://www.facebook.com/ethanmuller" target="_blank">the Facebook</a>
						if that's your thing.
					</h1>
					
				</header><!-- end header -->

	<?php
	print($form);
	} ?>

			</div><!-- end .content -->

<?php printFooter(); ?>

	</body>

</html>
